# 2025-02-06 TIL

## 작은 목표들: 방화벽 실습 
### ASA0 vlan 설정하기
- 제어판이 안 보임. 어떻게 찾아?
- 제어판 안 되면 일단 어제 했던 방식대로 
- 해결: 그냥 VLAN이 자동으로 돼 있음
- show running-config: 현재 방화벽 보안 설정 확인 가능. 보안 레벨도 확인 가능

### ASA0 inside/outside vlan 설정
- interface Vlan1
  - nameif inside
  - ip address ~~ 
  - security-level 100
- outside: 보안 레벨을 0으로

### 방화벽 라우팅
- ASA0 설정
  - route outside 0.0.0.0 0.0.0.0 203.237.20.254
  - outside vlan의 출력을 모두 라우터로 꽂아버림
- 문제: 정적 라우팅 설정이 show route 결과에 안 나옴
    - write memory , copy running-config startup-config
    - 인터페이스 이름에 오류가 있을지도
        - vlan 이름 확인하는 법: show interface <interface name>
            - 정상으로 존재하는 거 확인
    - 인터페이스 상태 확인:
    - 발견: Vlan2 "outside", is up, line protocol is down
    - no shutdown 설정을 안 했다.
    - 아래 문제가 여전히 해결이 안 됨.
    - Ethernet0/0 "", is down, line protocol is down (disabled)
    - 근데 내 생각에 이건 Vlan이라 Et 포트로 볼 게 아니라, Vlan으로 확인해야 맞다. 
    - line protocol이 활성화 되려면 해당 vlan에 포함된 물리 포트가 하나 이상 활성화 돼야 함. 그런데 지금 아무것도 활성화가 안 됨
        - asa 각 vlan 상태 확인하는 법
        - show running-config interface vlan 2
        - vlan에 연결된 장비 중 하나라도 활성화 돼서 트래픽이 있어야 vlan과 라우팅이 활성화됨. 그래서 외부망 포트에 라우터 대신 컴퓨터를 연결해서 일단 보이는 걸 확인했음. 이를 다시 라우터에 연결하면 꺼질텐데, 일단 컴퓨터를 라우터에 연결한 다음 라우팅 설정을 한 다음 이를 다시 asa에 연결하면 트래픽이 유지되겠지? 
        - 맞다. 아무튼 이렇게 라우팅 설정은 됐다.

### 방화벽 라우팅 2
- 핑 테스트.
    - in pc -> ASA: O
    - in pc -> out pc: X
- 패킷 시뮬레이션 결과: in PC -> ASA -> ROUTER 까지만 잘 감.
- out PC -> Router 패킷은 다음과 같이 설정됨
    - SRC: IP of out PC
    - DST: IP of in PC
    - 외부에서 안으로는 라우팅이 안 되는 상태! 그러므로 핑도 회수가 안 되는게 당연.
- 이를 위해 ASA에 나트 설정 해줘야 함.
```
configure terminal
object network in2out // Generates network object
subnet 192.168.1.0 255.255.255.0 //set sub network config
nat (inside, outside) dynamic interface // interface: use already assigned interface ip address of inside, outside for linking
exit
```
- show nat
- 이제 라우터에서 ASA까지는 잘 오는데, 
    - out PC packet DST: IP:203.237.20.253 -> well routed!
    - ASA에서 생성된 네트워크 오브젝트가 패킷에 끝까지 남아 라우팅을 담당한다!
- 그런데 ASA에서 걸림. -> Access Control List가 등장할 차례
```
access-list out2in extended permit icmp any any
```
- out2in 이라는 이름의 확장형 ACL 사용
- 출발지와 목적지가 어디든 ICMP 패킷 허용
```
access-group out2in in interface outside
```
- outside로 들어오는 패킷에 대해 out2in을 적용. 
- show running-config를 통해 이 설정들도 확인 가능

이렇게 끝!

## 작은목표들: 