# 네트워크 개념 정리 (2025-02-03)

## 1. OSI 7계층과 헤더
### OSI 7계층
| 계층 | 역할 | 주요 프로토콜 |
|------|------|--------------|
| 7. 응용 계층 | 사용자와 네트워크 간 인터페이스 | HTTP, FTP, SMTP |
| 6. 표현 계층 | 데이터 인코딩 및 암호화 | SSL/TLS, JPEG, ASCII |
| 5. 세션 계층 | 연결 설정, 유지, 종료 | NetBIOS, RPC |
| 4. 전송 계층 | 신뢰성 있는 데이터 전송 | TCP, UDP |
| 3. 네트워크 계층 | 패킷 라우팅 | IP, ICMP, ARP |
| 2. 데이터 링크 계층 | MAC 주소 기반 전송 | Ethernet, Wi-Fi, PPP |
| 1. 물리 계층 | 신호 전송 | 광케이블, UTP |

- OSI 계층은 1~7부터 순서대로 이루어지고 그런게 아니고 개념적인 체계. 예를 들어 와이파이 라우터는 와이파이 주파수(2.4GHz)를 통해 신호를 주고 받는다는 점에서 물리 계층에도 포함되고, 맥 주소 기반 데이터 통신을 해준다는 점에서 데이터 링크 계층에도 포함되고, 라우팅을 지원한다는 점에서 네트워크 계층에도 포함된다. (4계층부터는 포함 안 된다.)

### 헤더(Header) 정의
- 패킷에서 전송 데이터를 올바르게 처리하고 전달하기 위해, OSI 계층별 프로토콜이 추가하는 제어 정보 영역.

---

## 2. 주요 네트워크 개념
### 네트워크(Network)
- 두 개 이상의 장치가 데이터를 주고받을 수 있도록 연결된 시스템.

### 대역폭(Bandwidth)
- 네트워크에서 일정 시간 동안 전송할 수 있는 최대 데이터 용량 (bps, Mbps 등으로 측정).

### 프로토콜(Protocol)
- 네트워크에서 데이터를 송수신하는 규칙과 절차를 정의한 통신 규약.

### 트레일러(Trailer)
- 데이터의 끝부분에 추가되는 오류 검사 및 데이터 무결성 확인을 위한 정보.

### CSMA/CD (Carrier Sense Multiple Access with Collision Detection)
- 이더넷에서 여러 장치가 동일한 채널을 공유할 때 충돌을 감지하고 재전송하는 방식.

### WAN: Wide Area Network
- 도시, 국가, 대륙 간 네트워크
- LAN에 비교해서 느리고 별로지만, LAN의 제한거리가 100미터라서 장거리에는 WAN을 써야 한다.

---

## 3. IP 관련 개념
### IP 주소 클래스
- A, B, C, D, E 클래스로 나뉘며, 네트워크 크기에 따라 사용됨.
- 아이피 클래스는 이제 안 쓰고, 현재는 "클래스리스 방식(CIDR, Classless Inter-Domain Routing, 클래스 없는 도메인 간 라우팅)"이 사용됨.

### 서브넷 마스크(Subnet Mask)
- IP 주소를 네트워크 부분과 호스트 부분으로 구분하는 값. 그 표현 방식이 CIDR
- 서브넷을 설정하면 네트워크를 세분화하여 더 효율적으로 IP를 할당 가능.
- 서브넷 마스크 읽는 방법(CIDR 표기법)
  - 127.3.1.0/24 이 경우 서브넷 마스크는 24 = 8 * 3, 즉 255.255.255.0
  - /24는 네트워크 부분을 의미함. 나머지 8은 호스트 아이피. 
  - 왜 24로 표현되나? 이건 바이트를 십진수로 표현하는 방식임
  - 즉슨, 255.255.255.0은 각 바이트를 십진수로 표현한 값. 이걸 이진수로 표현하면?
  - 11111111.11111111.11111111.00000000
  - 이렇게 네트워크 주소를 표현함. 그러므로 여기서 마지막 바이트가 호스트 표현 영역이므로, 00000000~11111111(0~255)이 표현할 수 있는 호스트 수가 된다.
  - 그런데 00000000과 11111111은 각각의 역할이 부여돼 있음
  - 00000000: 해당 서브넷의 첫 번째 IP 주소로, 서브넷 자체를 식별하는 역할을 함. 그래서 이를 **네트워크 주소**로 부른다. 여기를 비워놔야 네트워크 식별이 되기 때문.
  - 11111111: 브로드캐스트 주소. 예를 들어 라우터의 아이피에서 xxx.x.x.255로 오는 데이터는 브로드캐스팅 데이터임.

### CIDR VS 서브넷 마스크
- CIDR은 IP 주소를 네트워크와 호스트 부분으로 나누는 방법을 의미하며, 서브넷 마스크는 이를 표현하는 도구이다.

### NAT(Network Address Translation)
- 공인 IP 하나를 사용하여 내부 네트워크의 여러 사설 IP를 인터넷에 연결하는 기술.
- 라우터가 포트 기반으로 내부 장치와 인터넷을 매핑.

### 스위치 vs 허브
- 둘 다 로컬 네트워크 안의 장치들을 연결해주는 장비.
- 기능은 같은데, 스위치가 좀 더 똑똑하게 할당해준다.

---

## 4. 네트워크 라우팅과 보안
### 라우팅(Routing)
- 패킷을 목적지까지 전달하기 위해 경로를 선택하는 과정.
- IP 주소를 기반으로 이루어짐.
- 당장 다음 스텝으로 나아가기 위해서는 맥 주소가 필요함. 

### VPN(Virtual Private Network)
- 공용 네트워크를 통해 사설 네트워크를 안전하게 연결하는 기술.
- 물리적으로는 공용 네트워크와 같은 인프라를 쓰지만 논리적으로 독립 돼 있어서 사설 망처럼 사용 가능.
- IPSec, OpenVPN, WireGuard 등의 프로토콜 사용.

### 방화벽(Firewall)
- 네트워크 트래픽을 필터링하여 불법 접근을 차단하는 보안 장치.
- 특정 IP 또는 MAC 주소만 허용 가능.

---

## 5. 주요 네트워크 프로토콜
### DHCP(Dynamic Host Configuration Protocol)
- 네트워크 장치에 IP 주소, 서브넷 마스크, 게이트웨이 등의 설정을 자동 할당.

### DNS(Domain Name System)
- 도메인 이름을 IP 주소로 변환하는 시스템.

### Keepalive
- 네트워크 연결이 유휴 상태에서도 끊어지지 않도록 주기적으로 신호를 보내는 메커니즘.

### 파싱(Parsing) (네트워크 관점)
- 네트워크 프로토콜 데이터를 분석하여 헤더, 페이로드 등 의미 있는 정보로 분리하고 처리하는 과정.
- 예: HTTP 파싱, DNS 응답 파싱, 패킷 캡처 분석 등.

---

## 6. TCP, UDP, 로드 밸런서
### TCP (Transmission Control Protocol)
- 연결 지향 프로토콜, 3-way handshake 사용, 신뢰성 보장.
- 예: 웹 브라우징, 이메일 전송.

### UDP (User Datagram Protocol)
- 비연결형 프로토콜, 빠른 전송이 가능하지만 신뢰성이 낮음.
- 그럼에도 패리티 검출을 하기는 한다.
- 예: 스트리밍, VoIP, 게임.

### 로드 밸런서(Load Balancer)
- 네트워크 부하를 여러 서버로 분산하여 성능과 가용성을 높이는 장치.
- L4 (전송 계층) → TCP/UDP 기반 부하 분산 (NLB) -> 전송 계층
- L7 (애플리케이션 계층) → HTTP 요청 기반 부하 분산 (ALB) -> 응용 계층

---

## 7. 기타 네트워크 명령어

### Traceroute 명령어
- 네트워크 경로를 추적하여 중간에 거치는 라우터 목록을 표시.
- Windows에서는 `tracert` 명령어 사용. (맥에서는 traceroute)

### Wireshark
- 네트워크 패킷을 캡처하고 분석하는 도구.
- 네트워크 트래픽을 실시간으로 모니터링 가능.

---

## 8. NAS와 보안 설정(개인적으로 궁금해서 찾아본 점)

### VPN을 이용한 NAS 구축
- NAS를 직접 인터넷에 노출하지 않고 VPN을 통해 안전하게 접속 가능.
- 포트 포워딩 없이도 원격 접속 가능하여 보안성이 높아짐.

### 방화벽 설정으로 NAS 보호
- 특정 IP 또는 MAC 주소만 허용하여 NAS 접근을 차단 가능.
- VPN과 병행하면 더욱 안전한 보안 환경 구축 가능.

---

## 9. CDN: Contents Delivery Network
- 대용량 컨텐츠 데이터를 미리미리 가까운 서버에 보내놓고 송출하는 네트워크
- 근거리에 고성능 서버를 갖다놓고 쓴다.

---

## 헷갈렸던 점

### 멀티 캐스팅과 유니 캐스팅의 차이
- 내가 헷갈린 부분: 유니캐스팅이 1대 1 통신이고, 멀티캐스팅이 1대 다수 통신이라고 했는데, 그럼 유니캐스트 방식으로 웹 페이지에 접속하면 나 말고 다른 사람은 못 쓰는 것 아닌가? 그런 점에서 거의 모든 서비스가 멀티 캐스팅이어야 하는 것 아닌가?
- 답변: 멀티 캐스팅과 유니 캐스팅은 프로세스 단위에서 발생하는 내용임. 즉 유니 캐스팅의 경우, 하나의 프로세스가 하나의 패킷을 주고 받는 방식이고, 멀티 캐스팅의 경우 하나의 프로세스가 여러 개의 패킷을 주고 받음. 그렇다면 유니 캐스팅 방식의 웹 서비스는 어떻게 동시에 여러 패킷을 처리하는가? -> 멀티 태스킹( != 멀티 캐스팅). 따라서 여러 사람이 동시에 봐도 문제가 없는 동영상 스트리밍(멀티 캐스팅)과 달리 유니 캐스팅을 사용하는 서비스에 여러 사람이 몰리면 속도가 많이 느려진다.

--- 

## Top Down Quarter
### 랜 안에서 공유되는 ARP 확인하는 법
```
! arp -a
? (169.254.169.254) at (incomplete) on en0 [ethernet]
? (169.254.255.255) at ff:ff:ff:ff:ff:ff on en9 [ethernet]
? (172.30.1.16) at e2:6:6e:f1:c4:30 on en0 ifscope [ethernet]
? (172.30.1.254) at b4:a9:4f:e:f3:6 on en0 ifscope [ethernet]
? (172.30.1.255) at ff:ff:ff:ff:ff:ff on en0 ifscope [ethernet]
mdns.mcast.net (224.0.0.251) at 1:0:5e:0:0:fb on en0 ifscope permanent [ethernet]  
```

```
 traceroute 8.8.8.8
traceroute to 8.8.8.8 (8.8.8.8), 64 hops max, 40 byte packets
 1  172.30.1.254 (172.30.1.254)  120.298 ms  3.446 ms  3.346 ms // 로컬 네트워크의 라우터(우리집 와이파이 공유기)
 2  118.45.3.254 (118.45.3.254)  6.487 ms  7.041 ms  138.118 ms // ISP로 연결되는 라우터
 3  112.191.236.165 (112.191.236.165)  5.725 ms  4.699 ms  4.441 ms // ISP 내부 네트워크
 4  112.190.135.157 (112.190.135.157)  7.690 ms 
    112.190.135.37 (112.190.135.37)  137.489 ms
    112.190.135.241 (112.190.135.241)  7.515 ms
 5  112.174.48.106 (112.174.48.106)  7.817 ms  9.268 ms
    112.190.29.249 (112.190.29.249)  9.189 ms
 6  112.174.84.54 (112.174.84.54)  7.672 ms
    112.174.84.46 (112.174.84.46)  7.625 ms  7.321 ms
 7  72.14.243.228 (72.14.243.228)  165.878 ms  138.202 ms // 구글 네트워크에 진입
    142.250.165.78 (142.250.165.78)  30.221 ms
 8  * * * 
 9  dns.google (8.8.8.8)  35.842 ms  138.350 ms  95.183 ms 
 ```
 - 하나의 홉에 여러 아이피가 찍히는 이유
  - 로드 밸런싱: ISP는 트래픽 부하를 분산하기 위해 여러 라우터를 사용(네트워크 계층(3계층)에서 이루어짐.)
  - ICMP 패킷이 다르개 라우팅되는 경우: 응답이 여러 경로에서 올 수 있음.
  - MPLS(Multi-Protocol Label Switching) 경로 변화: 패킷 경로 최적화
  - NAT(Network Address Translation) 또는 방화벽의 개입: 네트워크 장비가 여러 개의 IP를 가질 수 있음.
